<!DOCTYPE html>
<!-- Coding By CodingNepal - www.codingnepalweb.com -->
<html lang="en" dir="ltr">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
    
    <title>Chatbot in JavaScript | CodingNepal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0">
    <script src="script.js" defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot in JavaScript | CodingNepal</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" rel="stylesheet">
    <script src="script.js" defer></script>
  <meta charset="utf-8">
  <title>Chatbot in JavaScript | CodingNepal</title>
  <link rel="stylesheet" href="style.css">

   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <!-- Google Fonts Link For Icons -->
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts Link For Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
  <script src="script.js" defer></script>
</head>
<body>
  <div class="cartoon">
    <div class="shoulders"></div>
    <div class="hair-back"></div>
    <div class="neck"></div>
    <div class="ear ha hb"></div>
    <div class="ear ha hb"></div>
    <div class="face">
      <div class="cheek"></div>
      <div class="nose"></div>
      <div class="mouth">
        <div class="teeth"></div>
        <div class="top-lip"></div>
        <div class="bottom-lip"></div>
      </div>
      
      
      <div class="eye">
        <div class="pupil"></div>
        <div class="eye-bright"></div>
      </div>
      <div class="eye">
        <div class="pupil"></div>
        <div class="eye-bright"></div>
      </div>
      <div class="eyebrow"></div>
      <div class="eyebrow"></div>
    </div>
    <div class="forehead"></div>
    <div class="hair-front-1"></div>
    <div class="hair-front-1"></div>
    <div class="hair-front-2"></div>
    <div class="hair-front-2"></div>
    <div class="hair-front-3"></div>
    <div class="hair-front-3"></div>
    <div class="hair-bangs"></div>
    <div class="shirt-neck"></div>
    <div class="shirt-neck"></div>
  </div>
  <div class="chatbot">
    <header>
      <h2>Chatbot</h2>
      <span class="close-btn material-symbols-outlined">close</span>
    </header>
    <ul class="chatbox">
      <li class="chat incoming">
        <span class="material-symbols-outlined">smart_toy</span>
        <p>Hi there <br>How can I help you today?</p>
      </li>
    </ul>
    <div class="chat-input">
      <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
      <span id="send-btn" class="material-symbols-rounded">send</span>
    </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const closeBtn = document.querySelector(".close-btn");
    const chatbox = document.querySelector(".chatbox");
    const chatInput = document.querySelector(".chat-input textarea");
    const sendChatBtn = document.querySelector(".chat-input span");
    let userMessage = null; // Variable to store user's message
    const API_KEY = "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"; // Paste your API key here
    const inputInitHeight = chatInput.scrollHeight;

    // Function to create a chat <li> element
    const createChatLi = (message, className) => {
        const chatLi = document.createElement("li");
        chatLi.classList.add("chat", `${className}`);
        let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">smart_toy</span><p></p>`;
        chatLi.innerHTML = chatContent;
        chatLi.querySelector("p").textContent = message;
        return chatLi;
    }

    // Function to speak the response
    const speakResponse = (text) => {
        const speech = new SpeechSynthesisUtterance(text);
        speech.lang = 'en-US'; // Set language to English (United States)
        speech.volume = 1; // Set volume (0 to 1)
        speech.rate = 1; // Set rate (0.1 to 10)
        speech.pitch = 1; // Set pitch (0 to 2)
        window.speechSynthesis.speak(speech);
    }

    // Function to initialize mouth animation
    const initializeMouthAnimation = () => {
        const mouthElement = document.querySelector(".mouth");
        mouthElement.style.animation = "none"; // Set animation to none initially
        mouthElement.offsetHeight; /* trigger reflow */
        mouthElement.style.animation = null; // Reset animation
    };

    // Function to stop mouth animation
    const stopMouthAnimation = () => {
        const mouthElement = document.querySelector(".mouth");
        mouthElement.style.animation = "none"; // Set animation to none
    };

    // Function to trigger mouth animation based on response content
const triggerMouthAnimation = (responseText) => {
    const mouthElement = document.querySelector(".mouth");
    const words = responseText.split(" ");
    let index = 0;

    // Function to animate mouth for each word
    const animateMouthForWord = () => {
        if (index < words.length) {
            const word = words[index];
            // Calculate duration based on word length or other factors
            const duration = word.length * 100; // Adjust duration as needed
            mouthElement.style.animation = "openClose " + duration + "ms ease";
            index++;
            setTimeout(animateMouthForWord, duration);
        } else {
            // End of speech, stop mouth animation
            mouthElement.style.animation = "none";
        }
    };

    // Start mouth animation for each word
    animateMouthForWord();
};


    // Function to generate a response from the chatbot API
    const generateResponse = (chatElement) => {
        const API_URL = "https://api.openai.com/v1/chat/completions";
        const messageElement = chatElement.querySelector("p");

        const requestOptions = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [{ role: "user", content: userMessage }],
            })
        }

        fetch(API_URL, requestOptions)
            .then(res => res.json())
            .then(data => {
                const responseText = data.choices[0].message.content.trim();
                messageElement.textContent = responseText;
                speakResponse(responseText);
                triggerMouthAnimation(responseText); // Trigger mouth animation based on response
            })
            .catch(() => {
                messageElement.classList.add("error");
                messageElement.textContent = "Oops! Something went wrong. Please try again.";
            })
            .finally(() => chatbox.scrollTo(0, chatbox.scrollHeight));
    };

    // Function to handle user input and initiate chat
    const handleChat = () => {
        userMessage = chatInput.value.trim();
        if (!userMessage) return;

        chatInput.value = "";
        chatInput.style.height = `${inputInitHeight}px`;

        chatbox.appendChild(createChatLi(userMessage, "outgoing"));
        chatbox.scrollTo(0, chatbox.scrollHeight);

        setTimeout(() => {
            const incomingChatLi = createChatLi("Thinking...", "incoming");
            chatbox.appendChild(incomingChatLi);
            chatbox.scrollTo(0, chatbox.scrollHeight);
            generateResponse(incomingChatLi);
        }, 600);
    }

    // Initialize mouth animation
    initializeMouthAnimation();

    // Event listeners
    chatInput.addEventListener("input", () => {
        chatInput.style.height = `${inputInitHeight}px`;
        chatInput.style.height = `${chatInput.scrollHeight}px`;
    });

    chatInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
            e.preventDefault();
            handleChat();
        }
    });

    sendChatBtn.addEventListener("click", handleChat);
    closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
});

</script>


</body>
</html>
